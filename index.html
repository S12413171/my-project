<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Expense Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: #f8f9fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .header-banner {
      background: linear-gradient(135deg, #031047, #205de0);
      border-radius: 0 0 20px 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .card-custom {
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    .summary-card {
      background: white;
      border-left: 6px solid #007bff;
      transition: transform 0.2s ease-in-out;
    }
    .summary-card:hover {
      transform: translateY(-3px);
    }
    .summary-card h5 {
      font-weight: 600;
    }
    .expense-table {
      max-height: 400px;
      overflow-y: auto;
    }
    .chart-box {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .table td {
      vertical-align: middle;
    }
    /* Category color badges */
    .badge-food { background: #28a745; }
    .badge-travel { background: #007bff; }
    .badge-rent { background: #dc3545; }
    .badge-other { background: #6c757d; }
    .badge-invest { background: #ff9800; }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="container-fluid py-5 mb-4 text-white text-center header-banner">
    <h1 class="fw-bold" style="font-size: 2.5rem;">ðŸ’° Daily Expense Tracker</h1>
    <p class="lead mb-0">Track your spending, investments & savings in one place</p>
  </div>

  <div class="container-fluid">
    <div class="row g-4">
      
      <!-- LEFT SIDE -->
      <div class="col-lg-8">
        
        <!-- Add Expense Form -->
        <div class="card card-custom p-4 mb-4">
          <h4 class="text-center mb-3">âž• Add Expense</h4>
          <form id="expense-form" class="row g-3">
            <div class="col-md-4">
              <input type="number" id="amount" class="form-control" placeholder="Amount" required>
            </div>
            <div class="col-md-4">
              <select id="category" class="form-select" required>
                <option value="">Select Category</option>
                <option value="Food">Food</option>
                <option value="Travel">Travel</option>
                <option value="Rent">Rent</option>
                <option value="Other">Other</option>
                <option value="Investment-SIP">Investment (SIP)</option>
                <option value="Investment-Stock">Investment (Stock)</option>
              </select>
            </div>
            <div class="col-md-4">
              <input type="date" id="date" class="form-control" required>
            </div>
            <div class="col-12 text-center">
              <button type="submit" class="btn btn-primary px-5">Add</button>
            </div>
          </form>
        </div>

        <!-- Current Month Expenses -->
        <div class="card card-custom p-3 mb-4">
          <h4 class="text-center">ðŸ“… Current Month Expenses</h4>
          <div class="expense-table">
            <table class="table table-striped mt-3" id="expense-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Category</th>
                  <th>Amount</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Charts -->
        <div class="row g-4">
          <div class="col-md-6">
            <div class="chart-box">
              <h5 class="text-center">ðŸ“ˆ Daily Spending Trend</h5>
              <canvas id="dailyChart"></canvas>
            </div>
          </div>
          <div class="col-md-6">
            <div class="chart-box">
              <h5 class="text-center">ðŸ“Š Category Distribution</h5>
              <canvas id="categoryChart"></canvas>
            </div>
          </div>
        </div>

      </div>

      <!-- RIGHT SIDE -->
      <div class="col-lg-4">
        <!-- Stats -->
        <div class="card summary-card p-3 mb-3">
          <h5>Total Expense</h5>
          <p id="total" class="fs-4 fw-bold">â‚¹0</p>
        </div>
        <div class="card summary-card p-3 mb-3">
          <h5>Average Food Expense</h5>
          <p id="food-average" class="fs-5">â‚¹0</p>
        </div>
        <div class="card summary-card p-3 mb-3">
          <h5>Rent Expenses</h5>
          <p id="rent-expense" class="fs-5">â‚¹0</p>
        </div>
        <div class="card summary-card p-3 mb-3">
          <h5>Other Expenses</h5>
          <p id="other-expense" class="fs-5">â‚¹0</p>
        </div>
        <div class="card summary-card p-3 mb-3">
          <h5>Investments</h5>
          <p>SIP: <span id="sip-expense">â‚¹0</span></p>
          <p>Stock: <span id="stock-expense">â‚¹0</span></p>
        </div>

        <!-- Archive -->
        <div class="card card-custom p-3">
          <h4 class="text-center">ðŸ“‚ Monthly Archive</h4>
          <div id="archive"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- JS -->
  <script>
    let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

    const form = document.getElementById("expense-form");
    const expenseTable = document.querySelector("#expense-table tbody");
    const totalEl = document.getElementById("total");
    const foodAverageEl = document.getElementById("food-average");
    const rentExpenseEl = document.getElementById("rent-expense");
    const otherExpenseEl = document.getElementById("other-expense");
    const sipExpenseEl = document.getElementById("sip-expense");
    const stockExpenseEl = document.getElementById("stock-expense");
    const archiveEl = document.getElementById("archive");

    // Render Expenses
    function renderExpenses() {
      expenseTable.innerHTML = "";
      const currentMonth = new Date().toISOString().slice(0,7);

      let total = 0, rent=0, other=0, sip=0, stock=0;
      let dailyMap = {}, categoryTotals = {};
      let foodTotal = 0, foodCount = 0;

      expenses.sort((a,b)=> new Date(b.date)-new Date(a.date));

      expenses.forEach((exp, idx) => {
        if (exp.date.startsWith(currentMonth)) {
          const row = document.createElement("tr");
          const badgeClass =
            exp.category === "Food" ? "badge-food" :
            exp.category === "Travel" ? "badge-travel" :
            exp.category === "Rent" ? "badge-rent" :
            exp.category.includes("Investment") ? "badge-invest" :
            "badge-other";

          row.innerHTML = `
            <td>${exp.date}</td>
            <td><span class="badge ${badgeClass}">${exp.category}</span></td>
            <td class="fw-bold text-danger">â‚¹${exp.amount}</td>
            <td><button class="btn btn-sm btn-danger" onclick="removeExpense(${idx})">X</button></td>
          `;
          expenseTable.appendChild(row);
        }

        total += exp.amount;
        categoryTotals[exp.category] = (categoryTotals[exp.category]||0)+exp.amount;

        if (exp.category === "Rent") rent += exp.amount;
        else if (exp.category === "Other") other += exp.amount;
        else if (exp.category === "Investment-SIP") sip += exp.amount;
        else if (exp.category === "Investment-Stock") stock += exp.amount;
        else if (exp.category === "Food") {
          foodTotal += exp.amount;
          foodCount++;
        }

        dailyMap[exp.date] = (dailyMap[exp.date]||0)+exp.amount;
      });

      // Stats
      totalEl.textContent = "â‚¹" + total;
      rentExpenseEl.textContent = "â‚¹" + rent;
      otherExpenseEl.textContent = "â‚¹" + other;
      sipExpenseEl.textContent = "â‚¹" + sip;
      stockExpenseEl.textContent = "â‚¹" + stock;

      const avgFood = foodCount > 0 ? (foodTotal / foodCount).toFixed(2) : 0;
      foodAverageEl.textContent = "â‚¹" + avgFood;

      renderArchive();
      updateCharts(dailyMap, categoryTotals);
    }

    // Archive
    function renderArchive(){
      archiveEl.innerHTML = "";
      let grouped = {};
      expenses.forEach(exp=>{
        let m = exp.date.slice(0,7);
        if(!grouped[m]) grouped[m]=[];
        grouped[m].push(exp);
      });
      for(let m in grouped){
        let total = grouped[m].reduce((a,b)=>a+b.amount,0);
        let div = document.createElement("div");
        div.className="mb-2";
        div.innerHTML = `
          <button class="btn btn-outline-primary w-100" data-bs-toggle="collapse" data-bs-target="#c${m.replace('-','')}">
            ${m} - Total: â‚¹${total}
          </button>
          <div class="collapse" id="c${m.replace('-','')}">
            <ul class="list-group mt-2">
              ${grouped[m].map(e=>`<li class="list-group-item">${e.date} - ${e.category}: â‚¹${e.amount}</li>`).join('')}
            </ul>
          </div>
        `;
        archiveEl.appendChild(div);
      }
    }

    // Charts
    let dailyChart, categoryChart;
    function updateCharts(dailyMap, categoryTotals){
      let ctx1 = document.getElementById("dailyChart").getContext("2d");
      let ctx2 = document.getElementById("categoryChart").getContext("2d");

      if(dailyChart) dailyChart.destroy();
      if(categoryChart) categoryChart.destroy();

      dailyChart = new Chart(ctx1,{
        type:"line",
        data:{
          labels:Object.keys(dailyMap).sort(),
          datasets:[{
            label:"Daily Spend (â‚¹)",
            data:Object.keys(dailyMap).sort().map(d=>dailyMap[d]),
            borderColor:"#007bff",
            backgroundColor:"rgba(0,123,255,0.2)",
            fill:true,
            tension:0.3,
            pointBackgroundColor:"#007bff"
          }]
        },
        options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
      });

      categoryChart = new Chart(ctx2,{
        type:"doughnut",
        data:{
          labels:Object.keys(categoryTotals),
          datasets:[{data:Object.values(categoryTotals),
            backgroundColor:["#28a745","#007bff","#dc3545","#6c757d","#ff9800","#9c27b0","#00bcd4"]}]
        },
        options:{plugins:{legend:{position:"bottom"}}}
      });
    }

    // Remove
    function removeExpense(idx){
      expenses.splice(idx,1);
      localStorage.setItem("expenses",JSON.stringify(expenses));
      renderExpenses();
    }

    // Add
    form.addEventListener("submit", e=>{
      e.preventDefault();
      let amount = +document.getElementById("amount").value;
      let category = document.getElementById("category").value || "Other";
      let date = document.getElementById("date").value;
      expenses.push({amount,category,date});
      localStorage.setItem("expenses",JSON.stringify(expenses));
      form.reset();
      renderExpenses();
    });

    renderExpenses();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
